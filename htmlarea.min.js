/**
 * A simple but extensible rich-text editor
 * copyright 2011 - Andy VanWagoner
 * license: MIT
 **/HtmlArea=function(a,b,c){var d,e;return this.options=b=HtmlArea.Utils.merge(this.options,b),this.strings=c=HtmlArea.Utils.merge(this.strings,c),this.setupEvents&&this.setupEvents(b),b.tools=this.optionToArray(b.tools),b.utils=this.optionToArray(b.utils),this.content=a=a||document.createElement("div"),this.element=document.createElement("div"),this.element.className="htmlarea "+b.style,a.parentNode&&(a.parentNode.insertBefore(this.element,a),a.parentNode.removeChild(a)),this.element.appendChild(a),a.nodeName.toLowerCase()==="textarea"?(d=this.textarea=a,a=this.content=document.createElement("div"),a.className=d.className,a.innerHTML=b.value||d.value,this.element.insertBefore(a,d)):(b.value&&(a.innerHTML=b.value),d=this.textarea=document.createElement("textarea"),d.name=b.name,d.className=a.className,d.value=this.getHTML(),this.element.appendChild(d)),d.style.display="none",d.spellcheck=!1,HtmlArea.Utils.addClass(a,"content"),a.contentEditable=!0,a.spellcheck=!0,this.can("styleWithCSS")&&this.exec("styleWithCSS",!1),/\S/.test(a.innerHTML)||(a.innerHTML+=HtmlArea.pbr),b.mode==="html"?this.setHTMLMode():this.mode="visual",e=this.tools=document.createElement("div"),e.className="tools "+b.style,e.innerHTML=this.buildTools(b.tools,c),b.toolsgo==="top"?this.element.insertBefore(e,a):this.element.appendChild(e),this.utils=this.setupUtils(b.utils),this.addListeners()},HtmlArea.prototype={options:{name:"content",style:"default",mode:"visual",toolsgo:"top",tools:"[bold,italic,underline,strike]|[sub,sup|left,center,right]|[bullet,number,indent,outdent]|[link,image,video,mode]",utils:"EditMedia,Drop"},strings:{bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strikethrough",sub:"Subscript",sup:"Superscript",left:"Align Left",center:"Align Center",right:"Align Right",justify:"Justify",bullet:"Bullet List",number:"Numbered List",indent:"Increase Indent",outdent:"Decrease Indent",undo:"Undo",redo:"Redo",mode:"View HTML"},optionToArray:function(a){return typeof a=="string"&&(a='"'+a.split("|").join(",|,").split(",").join('","')+'"',a="["+a.replace(/"\[/g,'["').replace(/\]"/g,'"]')+"]",window.JSON&&JSON.parse?a=JSON.parse(a):a=(new Function("return ("+a+");"))()),a},buildTools:function(a,b){var c=HtmlArea.Tools,d="",e,f,g,h=navigator.platform.indexOf("Mac")===0?"&#8984;":"ctrl ";for(e=0,f=a.length-1;e<=f;++e){a[e]==="|"&&(a[e]="separator");if(Object.prototype.toString.call(a[e])==="[object Array]")d+='<span class="tools">'+this.buildTools(a[e],b)+"</span>";else if(g=typeof a[e]=="object"?a[e]:c[a[e]])d+='<a data-tool="'+g.tool+'" class="'+g.tool,e||(d+=" first"),e===f&&(d+=" last"),d+='" title="'+(b[g.title]||g.title||""),g.key&&(d+=" "+h+g.key.toUpperCase()),d+='"><span>'+(g.text||g.tool)+"</span><em></em></a>",g.setup&&g.setup(this,this.options[g.tool+"Options"],this.strings[g.tool+"Strings"])}return d},setupUtils:function(a){var b=HtmlArea.Utils,c,d,e,f,g=this.options,h=this.strings,i=[];for(c=0,d=a.length;c<d;++c)f=a[c].substr(0,1).toLowerCase()+a[c].substr(1),i.push(this[f+"Util"]=new b[a[c]](this,g[f+"Options"],h[f+"Strings"]));return i},addListeners:function(){var a=this.bindEvent(this.updateTools);return this.ons(this.content,{blur:this.updateTextarea,keydown:this.shortcut}),this.ons(this.content,{focus:a,keyup:a,mouseup:a},!0),this.on(this.textarea,"keydown",this.shortcut),this.on(this.tools,"mousedown",this.toolRun),this.on(this.tools,"mouseup",a,!0),this},updateTextarea:function(){this.textarea.value=this.getHTML()},updateContent:function(){var a=HtmlArea.Cleaner.clean(this.textarea.value)||HtmlArea.pbr;this.content.innerHTML=a},setHTMLMode:function(){var a=HtmlArea.Utils;a.addClass(this.element,"html-mode"),this.updateTextarea(),this.textarea.style.height=a.getComputedStyle(this.content,"height"),this.textarea.style.width=a.getComputedStyle(this.content,"width"),this.textarea.style.display="",this.textarea.focus(),this.content.style.display="none",this.fire("modechange",{editor:this,mode:this.mode="html"})},setVisualMode:function(){var a=HtmlArea.Utils;a.removeClass(this.element,"html-mode"),this.updateContent(),this.textarea.style.display="none",this.content.style.display="",this.content.focus(),this.fire("modechange",{editor:this,mode:this.mode="visual"})},updateTools:function(a){/\S/.test(this.content.innerHTML)||(this.content.innerHTML+=HtmlArea.pbr,this.select(this.content.firstChild));var b=this.updateTools.toolMap,c,d,e,f=HtmlArea.Tools,g,h,i=HtmlArea.Utils;b||(b=this.updateTools.toolMap={},this.updateToolMap(b,this.options.tools));for(h in b)if((g=f[h]).update)g.update(this,b[h],a);else if(e=g.command)c=b[h],d=this.has(e),d===!1?(i.removeClass(c,"active"),i.removeClass(c,"indeterminate")):d?(i.addClass(c,"active"),i.removeClass(c,"indeterminate")):(i.removeClass(c,"active"),i.addClass(c,"indeterminate"));var i=this.utils,j,k,l;for(j=0,k=i.length;j<k;++j)(l=i[j]).update&&l.update()},updateToolMap:function(a,b){var c,d=b.length,e=this.tools,f=HtmlArea.Tools,g;for(c=0;c<d;++c)if(Object.prototype.toString.call(b[c])==="[object Array]")this.updateToolMap(a,b[c]);else if(g=f[b[c]])if(g.update||g.command)a[b[c]]=e.querySelector("."+b[c])},toolRun:function(a){var b=a.target,c;while(b&&b!=this.tools&&!b.getAttribute("data-tool"))b=b.parentNode;return b&&(c=HtmlArea.Tools[b.getAttribute("data-tool")],c&&c.run(this,b,a)),a.preventDefault&&a.preventDefault(),a.returnValue=!1},shortcut:function(a){if(!a||!a.ctrlKey&&!a.metaKey)return;var b=this.shortcut.keys,c=HtmlArea.Tools,d,e;if(!b){b=this.shortcut.keys={};for(d in c)c[d].key&&!c[d].magic&&(b[c[d].key.toLowerCase()]=c[d])}e=a.keyCode||a.which||a.charCode,e=HtmlArea.keys[e]||String.fromCharCode(e);if(d=b[e.toLowerCase()]){var f=this.tools.querySelector("."+d.tool);d.run(this,f,a)}},exec:function(a,b,c){this.content.focus(),document.execCommand(a,c||null,b||!1)},has:function(a){return document.queryCommandIndeterm(a)?undefined:document.queryCommandState(a)},can:function(a){try{return document.queryCommandSupported(a)}catch(b){}},get:function(a){return document.queryCommandValue(a)},insert:function(a){document.selection&&document.selection.createRange?document.selection.createRange().pasteHTML(a):this.exec("insertHTML",a)},getHTML:function(){return HtmlArea.Cleaner.clean(this.content)},getRange:function(a){var b=window.getSelection?window.getSelection():document.selection,c=b.rangeCount&&b.getRangeAt&&b.getRangeAt(0)||b.createRange&&b.createRange();return a==="text"?c&&(c.text||c.toString())||"":a==="node"?c&&(c.commonAncestorContainer||c.parentElement&&c.parentElement())||null:c},setRange:function(a){if(a&&window.getSelection){var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}else a&&a.select&&a.select();this.content.focus(),this.updateTools()},select:function(a){var b;a&&document.createRange?(b=document.createRange(),b.setStartBefore(a),b.setEndAfter(a)):a&&document.body.createTextRange&&(b=document.body.createTextRange(),b.moveToElementText(a)),this.setRange(b)}},HtmlArea.pbr="<p><br/></p>",HtmlArea.keys={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause_break",20:"caps_lock",27:"escape",33:"page_up",34:"page_down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"windows",92:"windows",93:"context",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"num_lock",145:"scroll_lock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},HtmlArea.Cleaner={clean:function(a){var b=document,c=b.createDocumentFragment(),d;a.nodeType===1?d=c.appendChild(a.cloneNode(!0)):(d=c.appendChild(b.createElement("div")),d.innerHTML=String(a));var e=d.querySelectorAll("font,span,[style]"),f,g,h=e.length+1,i,j=HtmlArea.Cleaner.styleRules,k,l,m=j.length,n;e=Array.prototype.slice.call(e,0).concat(d);for(g=0;g<h;++g){k=(f=e[g]).style.cssText.replace(/^\s+|\s+$/g,"");if(f.nodeName.toLowerCase()==="font"){i=f;if(l=i.getAttribute("color"))k+=" color: "+l;if(l=i.getAttribute("face"))k+=" font-face: "+l;if(l=i.getAttribute("size"))k+=" font-size: "+l;f=b.createElement("span"),f.style.cssText=k,i.parentNode.replaceChild(f,i);while(i.firstChild)f.appendChild(i.firstChild)}if(k){for(l=0;l<m;++l){if(!j[l][0].test(k))continue;k=k.replace(j[l][0],j[l][1]);if(j[l][2]){i=b.createElement(j[l][2]);while(f.firstChild)i.appendChild(f.firstChild);f.appendChild(i)}}f.style.cssText=k=k.replace(/^\s+|\s+$/g,"")}if(!k&&f!=d&&f.nodeName.toLowerCase()==="span"&&(!f.className||f.className.toLowerCase()==="apple-style-span")){n=f.parentNode;while(f.firstChild)n.insertBefore(f.firstChild,f);n.removeChild(f)}}return HtmlArea.Cleaner.cleanHTML(d.innerHTML)},cleanHTML:function(a){var b=HtmlArea.Cleaner.tagRules,c,d,e=b.length,f=a.replace,g=10;do for(d=0,c=a;d<e;++d)a=f.apply(a,b[d]);while(c!=a&&--g);return a.replace(/^\s+|\s+$/g,"")},tagRules:[[/<[^> ]*/g,function(a){return a.toLowerCase()}],[/<[^>]*>/g,function(a){return a.replace(/ [^=]+=/g,function(a){return a.toLowerCase()}).replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"').replace(/ slick-uniqueid="[^"]*"/g,"")}],[/(<(?:img|input)\b[^>]*[^\/])>/g,"$1 />"],[/<br\b[^>]*?>/g,"<br/>"],[/^<br\/>|<br\/>$/g,""],[/<br\/>\s*<\/(h1|h2|h3|h4|h5|h6|li|p|div)/g,"</$1"],[/<p>(?:&nbsp;|\s)*<br\/>(?:&nbsp;|\s)*<\/p>/g,"<p></p>"],[/ class="apple-style-span"| style=""/gi,""],[/^([^<]+)(<?)/,"<p>$1</p>$2"],[/<(\/?)div\b/g,"<$1p"],[/<(\/?)strong\b/g,"<$1b"],[/<(\/?)em\b/g,"<$1i"],[/<(\/?)(?:strike|del)\b/g,"<$1s"],[/\s*<(\/?(?:p|ol|ul)\b[^>]*)>\s*/g,"<$1>\n"],[/\s*<li([^>]*)>/g,"\n	<li$1>"],[/\s*<\/(p|ol|ul)>/g,"\n</$1>"],[/\s*<img\b([^>*?])>\s*/g,"\n<img$1>\n"],[/<p\b[^>]*>\s*<\/p>\s*<(ol|ul)\b/g,"<$1"],[/(<p\b[^>]*>\s*)(<(ul|ol)\b([^<]|<)*?<\/\3>\s*)/g,"$2$1"],[/^\s*$/g,""]],styleRules:[[/(text-decoration:.*?)\bline-through\b(;?)/gi,"$1$2","s"],[/(text-decoration:.*?)\bunderline\b(;?)/gi,"$1$2","u"],[/text-decoration:\s*;/i,""],[/font-style:\s*italic;?/gi,"","i"],[/font-weight:\s*bold;?/gi,"","b"]]},HtmlArea.Events=function(a){if(this instanceof HtmlArea.Events)return HtmlArea.Events(a);a=a||{};var b=HtmlArea.Events.prototype,c;for(c in b)a[c]=b[c];return a},HtmlArea.Events.prototype={bindEvent:function(a){var b=this,c=Array.prototype.slice,d=c.call(arguments,1);return function(e){return e=e||window.event,e&&(e.target=e.target||e.srcElement),a.apply(b,[e].concat(d,c.call(arguments,1)))}},bind:function(a){var b=this,c=Array.prototype.slice,d=c.call(arguments,1);return function(){return a.apply(b,d.concat(c.call(arguments,0)))}},setupEvents:function(a){a=a||{},this.events={};for(var b in a){b=String(b);if(b.substr(0,2)!=="on")continue;this.on(b.substr(2,1).toLowerCase()+b.substr(3),a[b])}return this},on:function(a,b,c,d){if(a.addEventListener)d||(c=this.bindEvent(c)),a.addEventListener(b,c,!1);else if(a.attachEvent)d||(c=this.bindEvent(c)),a.attachEvent("on"+b,c);else{d=c,c=b,b=a;var e=this.events[b]||(this.events[b]=[]),f=0,g=e.length;d||(c=this.bind(c));while(f<g&&e[f]!==c)++f;e[f]=c}return c},ons:function(a,b,c){if(a.nodeType==1)for(var d in b)this.on(a,d,b[d],c);else{c=b,b=a;for(var d in b)this.on(d,b[d],c)}},off:function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{c=b,b=a;var d=this.events[b],e;if(d){c||(d.length=0);for(e=d.length-1;e>=0;--e)d[e]===c&&d.splice(e,1)}}return c},offs:function(a,b){if(a.nodeType==1)for(var c in b)this.off(a,c,b[c]);else{b=a;for(var c in b)this.off(c,b[c])}},fire:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.events[a],d,e,f=!0;if(!c)return f;for(d=0,e=c.length;d<e;++d)c[d].apply(this,b)===!1&&(f=!1);return f}},HtmlArea.Events(HtmlArea.prototype),HtmlArea.Utils={getPosition:function(a,b){var c=HtmlArea.Utils,d=a.getBoundingClientRect(),e=document.documentElement,f=!document.compatMode||document.compatMode=="CSS1Compat"?e:document.body,g={x:window.pageXOffset||f.scrollLeft,y:window.pageYOffset||f.scrollTop},h=c.getComputedStyle(a,"position")=="fixed",i={x:Math.round(d.left)+(h?0:g.x)-e.clientLeft,y:Math.round(d.top)+(h?0:g.y)-e.clientTop};if(b){var j=c.getPosition(b);i.x=i.x-j.x-parseInt(c.getComputedStyle(b,"borderLeftWidth"),10),i.y=i.y-j.y-parseInt(c.getComputedStyle(b,"borderTopWidth"),10)}return i},getComputedStyle:function(a,b){var c=window.getComputedStyle?window.getComputedStyle(a,null):a.currentStyle;return c?c[b]:null},addClass:document.documentElement.classList?function(a,b){a.classList.add(b)}:function(a,b){a.className=((" "+a.className+" ").replace(" "+b+" "," ")+" "+b).replace(/^\s+|\s+$/g,"")},removeClass:document.documentElement.classList?function(a,b){a.classList.remove(b)}:function(a,b){a.className=(" "+a.className+" ").replace(" "+b+" "," ").replace(/^\s+|\s+$/g,"")},hasClass:document.documentElement.classList?function(a,b){return a.classList.contains(b)}:function(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>=0},contains:/\{\s*\[native code\]\s*\}/.test(""+document.documentElement.contains)?function(a,b){return a.contains(b)}:document.documentElement.compareDocumentPosition?function(a,b){return a===b||!!(a.compareDocumentPosition(b)&16)}:function(a,b){while(b&&b!==a)b=b.parentNode;return b===a},unwrap:function(a){var b=a.parentNode,c;while(c=a.firstChild)b.insertBefore(a.removeChild(c),a);b.removeChild(a)},merge:function(){var a={},b,c=arguments.length,d,e=Object.prototype.toString,f="[object Object]";for(d in arguments[0])a[d]=arguments[0][d];for(b=1;b<c;++b)for(d in arguments[b])e(a[d])===f&&e(arguments[b][d])===f?a[d]=HtmlArea.Utils.merge(a[d],arguments[b][d]):a[d]=arguments[b][d];return a},format:function(a){var b=arguments;return String(a).replace(/\\?\{([^{}]+)\}/g,function(a,c){if(a.charAt(0)=="\\")return a.slice(1);var d=1,e=b.length;while(d<e&&(!b[d]||b[d][c]==null))++d;return d<e?b[d][c]:""})}},HtmlArea.Utils.Upload=function(a){return this.setupEvents(a)},HtmlArea.Utils.Upload.prototype=HtmlArea.Events({canUploadXhr:function(){return window.File&&window.FormData&&window.XMLHttpRequest&&!0||!1},uploadForm:function(a){return this.canUploadXhr()?this.uploadXhr(new FormData(a),a.action):this.uploadIframe(a)},uploadXhr:function(a,b){var c=new XMLHttpRequest,d=this;return c.onload=function(a){d.uploadSuccess(a,c)},c.onabort=c.onerror=function(a){d.uploadFailure(a,c)},c.upload.onprogress=function(a){d.uploadProgress(a,c)},c.open("POST",b,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.send(a),c},uploadIframe:function(a){function e(a){c.uploadFailure(a||window.event,d)}function f(a){c.uploadIframeRSC(a||window.event,d)}var b=a.target,c=this,d=document.createElement("iframe");d.id=d.name=this.getUploadIframeId(),d.src='javascript:""',d.style.cssText="position:absolute;left:-9px;top:-9px;width:1px;height:1px",d=a.appendChild(d),d.onerror=d.onabort=e,d.onload=d.onreadystatechange=f,a.target=d.name,a.submit(),a.target=b},getUploadIframeId:function(){var a=0;return function(){return"htmlarea_utils_upload_iframe_"+ ++a}}(),uploadIframeRSC:function(a,b){if(b.readyState&&b.readyState!=="loaded"&&b.readyState!=="complete")return;var c=b.contentWindow.document.body,d={responseText:c.textContent||c.innerText};this.uploadSuccess(a,d),b.onerror=b.onabort=b.onload=b.onreadystatechange=null,b.parentNode.removeChild(b)},uploadSuccess:function(a,b){var c,d;try{window.JSON&&JSON.parse?c=JSON.parse(b.responseText):c=(new Function("return ("+b.responseText+");"))()}catch(d){return this.uploadFailure(a,b,d)}if(!c)return this.uploadFailure(a,b,null);if(c.error)return this.uploadFailure(a,b,c.error);this.fire("uploadSuccess",{response:c,xhr:b})},uploadFailure:function(a,b,c){this.fire("uploadFailure",{error:c,event:a,xhr:b})},uploadProgress:function(a,b){this.fire("uploadProgress",{event:a,xhr:b})}}),HtmlArea.Utils.EditMedia=function(a,b,c){this.editor=a,this.options=HtmlArea.Utils.merge(this.options,b),this.strings=HtmlArea.Utils.merge(this.strings,c),this.setupEvents(this.options),this.tagExpr=new RegExp("^\\s*<("+this.options.tags.split(",").join("|")+")\\b[^>]*>\\s*$","i"),this.on(a.content,"mouseover",this.mouseOver),a.content.attachEvent&&a.content.attachEvent("oncontrolselect",function(a){a.returnValue=!1})},HtmlArea.Utils.EditMedia.prototype=HtmlArea.Events({emptyGif:"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",template:'<img src="{emptyGif}" /><div class="tools">{tools}</div><div class="resize">{resizeTools}</div>',options:{tags:"img,video,iframe,object,embed"},strings:{resize:"Resize",inline:"Inline",floatLeft:"Float Left",floatRight:"Float Right",remove:"Remove"},tools:[{tool:"float-left",title:"floatLeft",text:'<hr class="full"/><hr/><hr/><hr/><hr/><hr class="full"/><b></b>'},{tool:"float-none",title:"inline",text:'<hr class="full"/><hr/ class="left"><hr class="right"/><hr class="full"/><b></b>'},{tool:"float-right",title:"floatRight",text:'<hr class="full"/><hr/><hr/><hr/><hr/><hr class="full"/><b></b>'},"|",{tool:"remove",title:"remove",text:"&times;"}],resizeTools:[{tool:"resize-top",title:"resize",text:"&nbsp;"},{tool:"resize-left",title:"resize",text:"&nbsp;"},{tool:"resize-right",title:"resize",text:"&nbsp;"},{tool:"resize-bottom",title:"resize",text:"&nbsp;"},{tool:"resize-top-left",title:"resize",text:"&nbsp;"},{tool:"resize-top-right",title:"resize",text:"&nbsp;"},{tool:"resize-bottom-left",title:"resize",text:"&nbsp;"},{tool:"resize-bottom-right",title:"resize",text:"&nbsp;"}],mouseOver:function(a){var b=a.target||a.srcElement;if((","+this.options.tags+",").indexOf(","+b.nodeName.toLowerCase()+",")<0)return;this.mask||(this.mask=new Image,this.mask.className="htmlarea-edit-media-mask",this.mask.src=this.emptyGif,this.on(this.mask,"mouseout",this.maskOut),this.on(this.mask,"mousedown",this.select)),this.maskElm(b)},maskOut:function(a){this.masked=null;var b=this.mask.parentNode;b&&b.removeChild(this.mask)},maskElm:function(a){var b=this.mask.style,c=HtmlArea.Utils.getPosition(a,this.editor.element);b.width=a.offsetWidth+"px",b.height=a.offsetHeight+"px",b.left=c.x+"px",b.top=c.y+"px",this.editor.element.appendChild(this.mask),this.masked=a},getUI:function(){if(this.ui)return this.ui;var a=this.ui=document.createElement("div");return a.className="htmlarea-edit-media",a.innerHTML=HtmlArea.Utils.format(this.template,{tools:this.editor.buildTools(this.tools,this.strings),resizeTools:this.editor.buildTools(this.resizeTools,this.strings)},this.strings,this),this.on(a,"mousedown",this.edit),this.proxy=a.getElementsByTagName("img")[0],this.resizeMouseMove=this.bindEvent(this.resizeMouseMove),this.resizeMouseDone=this.bindEvent(this.resizeMouseDone),this.resizeEvents={mousemove:this.resizeMouseMove,mouseup:this.resizeMouseDone,mouseleave:this.resizeMouseDone},this.editor.fire("buildEditMediaPanel",{editor:this.editor,panel:a,tool:this}),a},select:function(a){return this.editor.select(this.masked),this.elm||(this.elm=this.masked,this.show()),a.preventDefault(),!1},update:function(){var a=this.editor.getRange(),b=a,c,d,e,f=","+this.options.tags+",";if(a&&a.cloneRange){a=b.cloneRange(),a.startContainer.nodeType===3&&a.startOffset===a.startContainer.length&&a.setStartAfter(a.startContainer);while(a.startOffset===a.startContainer.childNodes.length)a.setStartAfter(a.startContainer);(d=a.startContainer).nodeType!==3&&(d=d.childNodes[a.startOffset]),a=b.cloneRange();while(!a.endOffset)a.setEndBefore(a.endContainer);(e=a.endContainer).nodeType!==3&&(e=e.childNodes[a.endOffset-1]),b.collapsed?(f.indexOf(","+e.nodeName.toLowerCase()+",")>=0&&(c=e),f.indexOf(","+d.nodeName.toLowerCase()+",")>=0&&(c=d)):e==d&&f.indexOf(","+d.nodeName.toLowerCase()+",")>=0&&(c=d)}else a&&a.duplicate&&this.tagExpr.test(a.htmlText)&&(c=a.parentElement());this.masked&&this.maskElm(this.masked),(this.elm=c||null)?this.show():this.hide()},show:function(){var a=this.elm,b=this.getUI(),c=this.editor,d=HtmlArea.Utils,e,f,g,h=d.getComputedStyle(a,"float")||"none",i=d.getPosition(a,c.element);e=b.getElementsByTagName("a");for(f=0,g=e.length;f<g;++f)d.removeClass(e[f],"active");d.addClass(b.querySelector(".float-"+h),"active"),b.style.width=a.offsetWidth+"px",b.style.height=a.offsetHeight+"px",b.style.left=i.x+"px",b.style.top=i.y+"px",a.nodeName.toLowerCase()==="img"?this.proxy.src=a.src:this.proxy.src=this.emptyGif,c.element.appendChild(b),c.fire("showEditMediaPanel",{editor:c,panel:b,element:a,tool:this})},hide:function(){var a=this.getUI(),b=a.parentNode;b&&b.removeChild(a),this.editor.fire("hideEditMediaPanel",{editor:this.editor,panel:a,element:this.elm,tool:this})},edit:function(a){function d(a){return String(a).replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})}var b=a.target||a.srcElement,c;while(b&&b!=this.editor.element&&!b.getAttribute("data-tool"))b=b.parentNode;return b&&(c=b.getAttribute("data-tool"))&&(c.indexOf("resize-")===0?this.runResize(this.elm,a,d(c.substr(6))):this[d("run-"+c)](this.elm,a)),a.preventDefault(),!1},runRemove:function(a){a.parentNode.href===a.src&&(a=a.parentNode);var b=a.parentNode;b&&b.removeChild(a),this.hide()},runFloatLeft:function(a){a.style.float="left",this.show()},runFloatNone:function(a){a.style.float="",this.show()},runFloatRight:function(a){a.style.float="right",this.show()},runResize:function(a,b,c){var d=HtmlArea.Utils,e={x:a.offsetWidth,y:a.offsetHeight},f=d.getPosition(a,this.editor.element);this.mouseOffset={from:c,size:e,pos:f,x:c.indexOf("Left")>=0?b.screenX+e.x:b.screenX-e.x,y:c.indexOf("Top")>=0?b.screenY+e.y:b.screenY-e.y},this.aspect=Math.max(e.x,1)/Math.max(e.y,1),this.ons(document.body,this.resizeEvents,!0)},resizeMouseMove:function(a){var b=this.mouseOffset,c,d=this.ui.style,e=this["resizeMove"+b.from](a,b,b.size,b.pos);for(c in e)d[c]=e[c]+"px"},resizeMouseDone:function(a){var b=HtmlArea.Utils,c=this.editor.element;this.offs(document.body,this.resizeEvents),this.elm.style.width=b.getComputedStyle(this.ui,"width"),this.elm.style.height=b.getComputedStyle(this.ui,"height"),this.show()},resizeMoveTop:function(a,b,c,d){var e=this.keepAspect(1,b.y-a.screenY);return e.top=d.y+(c.y-e.height),e.left=d.x+(c.x-e.width)/2,e},resizeMoveLeft:function(a,b,c,d){var e=this.keepAspect(b.x-a.screenX,1);return e.top=d.y+(c.y-e.height)/2,e.left=d.x+(c.x-e.width),e},resizeMoveRight:function(a,b,c,d){var e=this.keepAspect(a.screenX-b.x,1);return e.top=d.y+(c.y-e.height)/2,e},resizeMoveBottom:function(a,b,c,d){var e=this.keepAspect(1,a.screenY-b.y);return e.left=d.x+(c.x-e.width)/2,e},resizeMoveTopLeft:function(a,b,c,d){var e=this.keepAspect(b.x-a.screenX,b.y-a.screenY);return e.left=d.x+(c.x-e.width),e.top=d.y+(c.y-e.height),e},resizeMoveTopRight:function(a,b,c,d){var e=this.keepAspect(a.screenX-b.x,b.y-a.screenY);return e.top=d.y+(c.y-e.height),e},resizeMoveBottomLeft:function(a,b,c,d){var e=this.keepAspect(b.x-a.screenX,a.screenY-b.y);return e.left=d.x+(c.x-e.width),e},resizeMoveBottomRight:function(a,b,c,d){return this.keepAspect(a.screenX-b.x,a.screenY-b.y)},keepAspect:function(a,b){return this.aspect&&(a/b<this.aspect?a=this.aspect*b:b=a/this.aspect),{width:a,height:b}}}),HtmlArea.Utils.Drop=function(a,b,c){var d=a.options.imageOptions;this.editor=a,this.options=HtmlArea.Utils.merge(this.options,d,b),this.strings=HtmlArea.Utils.merge(this.strings,c),this.setupEvents(this.options),this.on(a.element,"dragenter",this.dragEnter)},HtmlArea.Utils.Drop.hasFiles=function(a){if(!a.dataTransfer||!a.dataTransfer.types)return!1;var b=a.dataTransfer.types,c,d=b.length;for(c=0;c<d;++c)if(b[c]==="Files")return!0;return!1},HtmlArea.Utils.Drop.prototype=HtmlArea.Events({options:{autoLink:!1,uploadMax:6291456,uploadURL:"/upload.json",uploadName:"file",errorTimeout:3e3},strings:{drop:"Drop to Upload"},emptyGif:"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",getUI:function(){var a=this.ui;return a||(a=this.ui=document.createElement("div"),a.className="htmlarea-drop",a.innerHTML="<label><span></span><em></em></label>",this.mask=document.createElement("div"),this.mask.className="mask",a.appendChild(this.mask),this.ons(this.mask,{dragleave:this.dragLeave,dragover:this.dragOver,drop:this.drop}),this.progress=a.querySelector("em"),this.span=a.querySelector("span"),editor.fire("buildDropPanel",{editor:editor,panel:a,tool:this})),a},dragEnter:function(a){if(!HtmlArea.Utils.Drop.hasFiles(a))return;var b=this.editor,c=this.getUI();this.progress.textContent="",this.span.textContent=this.strings.drop,HtmlArea.Utils.removeClass(c,"error"),c.width=b.element.offsetWidth+"px",c.height=b.element.offsetHeight+"px",b.element.appendChild(c),this.timer&&(clearTimeout(this.timer),this.timer=null),b.fire("showDropPanel",{editor:b,panel:c,tool:this})},dragLeave:function(a){this.editor.fire("hideDropPanel",{editor:this.editor,panel:this.hide(),tool:this})},dragOver:function(a){if(HtmlArea.Utils.Drop.hasFiles(a))return a.preventDefault(),a.stopPropagation(),!1},drop:function(a){var b=window.URL||window.webkitURL||{},c=a&&a.dataTransfer&&a.dataTransfer.files,d,e=c.length,f,g,h=this.getUI();this.editor.content.focus();for(d=0;d<e;++d){if(!(f=c[d]))continue;g=this.getFileError(f.name||"",f.size||NaN);if(g)this.editor.fire("error",{editor:this.editor,panel:h,tool:this,message:g});else{var i=b.createObjectURL&&b.createObjectURL(f)||this.emptyGif,j=new FormData,k=this.insertPlaceholder(i,f.name);j.append(this.options.uploadName,f),(new HtmlArea.Utils.Upload({onUploadSuccess:this.bind(this.uploadSuccess,k,i),onUploadFailure:this.bind(this.uploadFailure,k,i)})).uploadXhr(j,this.options.uploadURL)}}return this.hide(),a.preventDefault(),a.stopPropagation(),!1},uploadSuccess:function(a,b,c){if(!c.response.upload||!c.response.upload.url)return c.error="No Url Was Returned",this.uploadFailure(a,b,c);var d=document.getElementById(a),e=window.URL||window.webkitURL||{};e.revokeObjectURL&&this.emptyGif!==b&&e.revokeObjectURL(b),d.id="",d.src=c.response.upload.url,HtmlArea.Utils.removeClass(d,"image-placeholder");if(this.options.autoLink){var f=document.createElement("a");f.href=c.response.upload.href||c.response.upload.url,d.parentNode.replaceChild(f,d),f.appendChild(d)}var g=this.editor;setTimeout(function(){g.updateTools()},200)},uploadFailure:function(a,b,c){var d=c.error||"Upload Failed",e=this.getUI(),f=document.getElementById(a),g=window.URL||window.webkitURL||{};g.revokeObjectURL&&this.emptyGif!==b&&g.revokeObjectURL(b),this.editor.fire("error",{editor:this.editor,panel:e,tool:this,message:d});if(!f)return;f.className+=" error",setTimeout(function(){f.parentNode.removeChild(f)},3e3)},hide:function(){var a=this.getUI(),b=a.parentNode;return b&&b.removeChild(a),a},getFileError:function(a,b){var c,d=this.options.uploadMax||6291456;return/\.(jpg|jpeg|png|gif|bmp)$/i.test(a)?b&&b>d&&(c="Photo Is Too Large"):c="Invalid File Format",c},insertPlaceholder:function(a,b){var c=this.placeholderId(),d='<img id="'+c+'" class="image-placeholder" src="'+encodeURI(a)+'" />';this.editor.insert(d);try{this.editor.exec("enableObjectResizing",!1)}catch(e){}return c},placeholderId:function(){var a=0;return function(){return"img-place-"+ ++a}}()}),HtmlArea.Tools={addTools:function(a){for(var b in a)this.addTool(b,a[b]);return this},addTool:function(a,b){var c=HtmlArea.Tools.Tool;return b.tool=a,typeof b=="object"&&!(b instanceof c)&&(b=new c(b)),this[a]=b,this}},HtmlArea.Tools.Tool=function(a){for(var b in a)this[b]=a[b]},HtmlArea.Tools.Tool.prototype={run:function(a,b,c){if(this.mode!=a.mode&&this.mode!="both")return!1;var d=this.command;return d?a.exec(d,this.param,this.ui):!1},mode:"visual"},HtmlArea.Tools.addTools({separator:{text:"|"},bold:{title:"bold",text:"<b>B</b>",command:"bold",key:"b"},italic:{title:"italic",text:"<i>I</i>",command:"italic",key:"i"},underline:{title:"underline",text:"<u>U</u>",command:"underline",key:"u"},strike:{title:"strike",text:"<s>S</s>",command:"strikethrough"},sub:{title:"sub",text:"x<sub>2</sub>",command:"subscript"},sup:{title:"sup",text:"x<sup>2</sup>",command:"superscript"},left:{title:"left",text:'<hr/><hr class="odd"/><hr/><hr class="odd"/><hr/><hr class="odd"/>',command:"justifyLeft"},center:{title:"center",text:'<hr/><hr class="odd"/><hr/><hr class="odd"/><hr/><hr class="odd"/>',command:"justifyCenter"},right:{title:"right",text:'<hr/><hr class="odd"/><hr/><hr class="odd"/><hr/><hr class="odd"/>',command:"justifyRight"},justify:{title:"justify",text:"<hr/><hr/><hr/><hr/><hr/><hr/>",command:"justifyAll"},bullet:{title:"bullet",text:"<ul><li><b>&#9679;</b></li><li><b>&#9679;</b></li><li><b>&#9679;</b></li></ul>",command:"insertunorderedlist"},number:{title:"number",text:"<ol><li><b>1</b></li><li><b>2</b></li><li><b>3</b></li></ol>",command:"insertorderedlist"},indent:{title:"indent",text:'<hr class="full"/><hr/><hr/><hr/><hr/><hr class="full"/><b></b><b></b><b></b>',command:"indent"},outdent:{title:"outdent",text:'<hr class="full"/><hr/><hr/><hr/><hr/><hr class="full"/><b></b><b></b><b></b>',command:"outdent"},undo:{title:"undo",text:"&#8617;",command:"undo",key:"z",magic:!0},redo:{title:"redo",text:"&#8618;",command:"redo",key:"y",magic:!0},mode:{title:"mode",text:"&lt;/&gt;",key:"/",mode:"both",run:function(a,b){a.mode==="visual"?(HtmlArea.Utils.addClass(b,"active"),a.setHTMLMode()):(HtmlArea.Utils.removeClass(b,"active"),a.setVisualMode())}}}),HtmlArea.Tools.Link=function(a,b,c){this.editor=a,this.options=HtmlArea.Utils.merge(this.options,b),this.strings=HtmlArea.Utils.merge(this.strings,c),this.setupEvents(this.options)},HtmlArea.Tools.Link.prototype=HtmlArea.Events({update:function(a){var b=this.getLink();b?(HtmlArea.Utils.addClass(a,"active"),this.show(b.getAttribute("href"),b,a)):(HtmlArea.Utils.removeClass(a,"active"),this.hide(a))},strings:{placeholder:"Enter URL",newWindow:"Open in a new tab or window"},run:function(a){if(this.editor.mode!=="visual")return;if(this.link)return this.remove();var b=this.editor.getRange("text"),c=b,d=this;/^\S+@\S+\.\S+$/.test(c)?c="mailto:"+c:/^(\S)*[:\/?#.](\S)*$/.test(c)?/^\w+:\/\//.test(c)||(c="http://"+c):c="http://",this.editor.exec("createlink",c),this.show(c,this.getLink(),a),setTimeout(function(){d.getUI().firstChild.focus(),d.getUI().firstChild.select()},100)},getLink:function(){var a=this.editor,b=a.getRange("node"),c=this.getUI();if(this.link&&c==b||HtmlArea.Utils.contains(c,b))return this.link;while(b&&b.nodeName.toLowerCase()!=="a"&&b!=a.content)b=b.parentNode;return b!=a.content&&HtmlArea.Utils.contains(a.content,b)&&b},template:'<input type="text" class="url" placeholder="{placeholder}" /><a>&times;</a><br/><label><input type="checkbox" /> <span>{newWindow}</span></label>',getUI:function(){if(this.ui)return this.ui;var a=this.ui=document.createElement("div");return a.className="htmlarea-link",a.innerHTML=HtmlArea.Utils.format(this.template,this.options,this.strings,this),this.on(a,"mousedown",this.mouseDown),this.ons(a.firstChild,{keypress:this.keyPress,change:this.change}),this.on(a.lastChild.firstChild,"change",this.change),this.editor.fire("buildLinkPanel",{editor:this.editor,panel:a,tool:this}),a},show:function(a,b,c){if(b==this.link)return;var d=this.getUI(),e=HtmlArea.Utils.getPosition(b,this.editor.element);this.link=b,this.range=this.editor.getRange(),d.firstChild.value=a,d.lastChild.firstChild.checked=b.target==="_blank",d.style.left=e.x+"px",d.style.top=e.y+b.offsetHeight+"px",this.editor.element.appendChild(d),this.editor.fire("showLinkPanel",{editor:this.editor,panel:d,link:b,tool:this})},hide:function(){this.link=null;var a=this.getUI(),b=a.parentNode;b&&b.removeChild(a),this.editor.fire("hideLinkPanel",{editor:this.editor,panel:a,tool:this})},keyPress:function(a){if((a.keyCode||a.which||a.charCode)!==13)return;return this.editor.setRange(this.range),a.preventDefault(),!1},change:function(a){if(this.link){var b=this.getUI();this.link.href=b.firstChild.value,b.lastChild.firstChild.checked?this.link.target="_blank":this.link.target==="_blank"&&this.link.removeAttribute("target")}},mouseDown:function(a){var b=a.target.nodeName.toLowerCase();if(b==="input")return;return b==="a"&&this.remove(),a.preventDefault(),!1},remove:function(){this.link&&HtmlArea.Utils.unwrap(this.link),this.hide()}}),HtmlArea.Tools.Link.title="Link",HtmlArea.Tools.Link.text="link",HtmlArea.Tools.Link.setup=function(a){a.linkTool||(a.linkTool=new HtmlArea.Tools.Link(a))},HtmlArea.Tools.Link.update=function(a,b){a.linkTool.update(b)},HtmlArea.Tools.Link.run=function(a,b){a.linkTool.run(b)},HtmlArea.Tools.addTool("link",HtmlArea.Tools.Link),HtmlArea.Tools.Image=function(a,b,c){this.editor=a,this.options=HtmlArea.Utils.merge(this.options,b),this.strings=HtmlArea.Utils.merge(this.strings,c
),this.setupEvents(this.options),a.on("modechange",this.bind(this.hide))},HtmlArea.Tools.Image.prototype=HtmlArea.Events({emptyGif:"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",template:'<form action="{action}" method="post" enctype="multipart/form-data" encoding="multipart/form-data" accept-charset="utf-8"><h6><span>{title}</span><label><input type="radio" name="type" value="upload" checked /> {local}</label><label><input type="radio" name="type" value="url" /> {remote}</label></h6><label class="upload button choose"><span>{choose}</span><input type="file" name="{uploadName}" /></label><label class="url"><span>{urlLabel}</span><input type="text" name="url" placeholder="{urlPlaceholder}" /></label><div class="error"></div><input type="submit" class="button" value="{done}" disabled /><input type="button" class="button" value="{cancel}" /></form>',options:{autoLink:!1,uploadMax:6291456,uploadURL:"/upload.json",uploadName:"file"},strings:{title:"Add Picture:",local:"From My Computer",remote:"From the Web",choose:"Choose File",urlLabel:"Enter URL",urlPlaceholder:"Enter URL",done:"Done",cancel:"cancel"},getUI:function(){if(this.ui)return this.ui;var a=this.ui=document.createElement("div"),b=this.editor,c=HtmlArea.Utils,d=this.bindEvent(this.validate);return a.className="htmlarea-image upload",a.innerHTML=c.format(this.template,this.options,this.strings,this),this.uiFile=a.querySelector("input[type=file]"),this.uiUrl=a.querySelector("input[name=url]"),this.uiRadioUpload=a.querySelector("input[name=type][value=upload]"),this.uiRadioUrl=a.querySelector("input[name=type][value=url]"),this.uiSubmit=a.querySelector("input[type=submit]"),this.uiLabelUpload=a.querySelector("label.upload"),this.uiLabelSpan=this.uiLabelUpload.querySelector("span"),this.uiError=a.querySelector(".error"),c.Upload.prototype.canUploadXhr()&&(this.uiFile.multiple=!0),this.on(a.querySelector("form"),"submit",this.submit),this.on(a.querySelector("input[type=button]"),"click",this.cancel),this.on(this.uiRadioUpload,"change",this.typeChange),this.on(this.uiRadioUrl,"change",this.typeChange),this.on(this.uiFile,"change",d,!0),this.ons(this.uiUrl,{keydown:d,input:d,change:d},!0),b.fire("buildImagePanel",{editor:b,panel:a,tool:this}),a},show:function(){var a=this.getUI(),b=this.editor;this.range=b.getRange(),this.uiFile.value=this.uiUrl.value="",this.uiSubmit.disabled=!0,this.uiLabelSpan.innerHTML=this.chooseText,b.element.appendChild(a),b.fire("showImagePanel",{editor:b,panel:a,tool:this})},hide:function(){var a=this.getUI(),b=a.parentNode;b&&b.removeChild(a),this.editor.fire("hideImagePanel",{editor:this.editor,panel:a,tool:this})},submit:function(a){a.preventDefault();if(!this.validate())return!1;var b=this.getUI(),c;if(this.uiRadioUrl.checked)this.insert(this.uiUrl.value.replace(/^\s+|\s+$/g,""));else{this.editor.setRange(this.range);if(this.uiFile.multiple){var d=this.uiFile.files,e,f=d.length,g=b.firstChild,h=g.action,i,j=window.URL||window.webkitURL||{};for(e=0;e<f;++e)i=j.createObjectURL&&j.createObjectURL(d[e])||this.emptyGif,c=this.insertPlaceholder(i,d[e].name),data=new FormData,data.append(this.uiFile.name,d[e]),(new HtmlArea.Utils.Upload({onUploadSuccess:this.bind(this.uploadSuccess,c,i),onUploadFailure:this.bind(this.uploadFailure,c,i)})).uploadXhr(data,h)}else c=this.insertPlaceholder(this.emptyGif,this.uiFile.value.split(/[\/\\]/).slice(-1).join("")),(new HtmlArea.Utils.Upload({onUploadSuccess:this.bind(this.uploadSuccess,c,this.emptyGif),onUploadFailure:this.bind(this.uploadFailure,c,this.emptyGif)})).uploadForm(b.firstChild)}return this.hide(),!1},cancel:function(a){return this.hide(),a.preventDefault(),!1},typeChange:function(a){var b=a.target,c=b.value,d=this.getUI(),e=HtmlArea.Utils;if(e.hasClass(d,c))return;e.removeClass(d,c==="url"?"upload":"url"),e.addClass(d,c),this.validate(),this.uiError.innerHTML=""},validate:function(a){var b=this.getUI(),c="";if(this.uiRadioUrl.checked){var d=this.uiUrl.value.replace(/^\s+|\s+$/g,"");d||(c="URL Is Required")}else if(this.uiFile.multiple&&this.uiFile.files&&this.uiFile.files.length>1){var e=this.uiFile.files,f,g=e.length,h,i,j,k=this.uiFile.value.split(/[\/\\]/).slice(-1).join("");for(f=0;f<g&&!c;++f){if(!(j=e[f]))continue;h=(j&&j.name||"").split(/[\/\\]/).slice(-1).join(""),i=j&&j.size||NaN,c=this.getFileError(h,i)}this.uiLabelSpan.innerHTML=k||"Choose File"}else{var l=this.uiFile,j=l.files&&l.files[0],h=l.value.split(/[\/\\]/).slice(-1).join(""),i=j&&j.size||NaN;c=this.getFileError(h,i),this.uiLabelSpan.innerHTML=h||"Choose File"}return this.uiError.innerHTML=c||"",this.uiSubmit.disabled=!!c,a?!0:!c},getFileError:function(a,b){var c,d=this.options.uploadMax||6291456;return/\.(jpg|jpeg|png|gif|bmp)$/i.test(a)?b&&b>d&&(c=a+" is too large"):c=a+" is invalid",c},uploadSuccess:function(a,b,c){if(!c.response.upload||!c.response.upload.url)return c.error="No Url Was Returned",this.uploadFailure(a,b,c);var d=document.getElementById(a),e=window.URL||window.webkitURL||{};e.revokeObjectURL&&this.emptyGif!==b&&e.revokeObjectURL(b),d.id="",d.src=c.response.upload.url,HtmlArea.Utils.removeClass(d,"image-placeholder");if(this.options.autoLink){var f=document.createElement("a");f.href=c.response.upload.href||c.response.upload.url,d.parentNode.replaceChild(f,d),f.appendChild(d)}var g=this.editor;setTimeout(function(){g.updateTools()},200)},uploadFailure:function(a,b,c){var d=c.error||"Upload Failed",e=this.getUI(),f=document.getElementById(a),g=window.URL||window.webkitURL||{};g.revokeObjectURL&&this.emptyGif!==b&&g.revokeObjectURL(b),this.editor.fire("error",{editor:this.editor,panel:e,tool:this,message:d});if(!f)return;f.className+=" error",setTimeout(function(){f.parentNode.removeChild(f)},3e3)},insert:function(a,b){this.editor.setRange(this.range);var c='<img src="'+encodeURI(a)+'" />';this.options.autoLink&&(c='<a href="'+encodeURI(b||a)+'">'+c+"</a>"),this.editor.insert(c);try{this.editor.exec("enableObjectResizing",!1)}catch(d){}},insertPlaceholder:function(a,b){var c=this.placeholderId(),d='<img id="'+c+'" class="image-placeholder" src="'+encodeURI(a)+'" />';this.editor.insert(d);try{this.editor.exec("enableObjectResizing",!1)}catch(e){}return c},placeholderId:function(){var a=0;return function(){return"img-place-"+ ++a}}()}),HtmlArea.Tools.Image.title="Add Picture",HtmlArea.Tools.Image.text="<b>&#9679;</b><span>&#9728;</span>",HtmlArea.Tools.Image.setup=function(a,b){a.imageTool||(a.imageTool=new HtmlArea.Tools.Image(a,b))},HtmlArea.Tools.Image.run=function(a){a.imageTool.show()},HtmlArea.Tools.addTool("image",HtmlArea.Tools.Image),HtmlArea.Tools.Video=function(a,b,c){this.editor=a,this.options=HtmlArea.Utils.merge(this.options,b),this.strings=HtmlArea.Utils.merge(this.strings,c),this.setupEvents(this.options),a.on("modechange",this.bind(this.hide))},HtmlArea.Tools.Video.prototype=HtmlArea.Events({template:'<form action="" method="post"><h6><span>{title}</span></h6><label class="url"><span>{label}</span><input type="text" name="url" placeholder="{placeholder}" /></label><p>{explain}</p><div class="error"></div><input type="submit" class="button" value="{done}" disabled /><input type="button" class="button" value="{cancel}" /></form>',strings:{title:"Add Video:",label:"Enter URL or Embed Code",placeholder:"Enter URL or Embed Code",explain:"Accepts videos from YouTube and Vimeo",done:"Done",cancel:"Cancel"},getUI:function(){if(this.ui)return this.ui;var a=this.ui=document.createElement("div"),b=this.editor,c=this.bindEvent(this.validate);return a.className="htmlarea-video",a.innerHTML=HtmlArea.Utils.format(this.template,this.options,this.strings,this),this.on(a.firstChild,"submit",this.submit),this.on(a.querySelector("input[type=button]"),"click",this.cancel),this.ons(a.querySelector("input[name=url]"),{keydown:c,input:c,change:c},!0),b.fire("buildVideoPanel",{editor:b,panel:a,tool:this}),a},show:function(){var a=this.getUI(),b=this.editor;this.range=b.getRange(),a.querySelector("input[name=url]").value="",a.querySelector("input[type=submit]").disabled=!0,b.element.appendChild(a),b.fire("showVideoPanel",{editor:b,panel:a,tool:this})},hide:function(){var a=this.getUI(),b=a.parentNode;b&&b.removeChild(a),this.editor.fire("hideVideoPanel",{editor:this.editor,panel:a,tool:this})},submit:function(a){if(this.validate()){var b=this.getUI(),c=b.querySelector("input[name=url]"),d=c.value.replace(/^\s+|\s+$/g,"");this.insert(this.getHtmlFor(d)),this.hide()}return a.preventDefault(),!1},cancel:function(a){return this.hide(),a.preventDefault(),!1},validate:function(a){var b=this.getUI(),c,d=b.querySelector("input[name=url]"),e=d.value.replace(/^\s+|\s+$/g,"");return e?this.getHtmlFor(e)||(c="Invalid Format"):c="URL or Embed Code Is Required",b.querySelector(".error").innerHTML=c||"",b.querySelector("input[type=submit]").disabled=!!c,a?!0:!c},insert:function(a){this.editor.setRange(this.range),this.editor.insert(a);try{this.editor.exec("enableObjectResizing",!1)}catch(b){}},getHtmlFor:function(a){var b=this.formats,c,d,e;for(c=0,d=b.length;c<d;++c){e=b[c];if(e.test.test(a))return a.replace(e.test,e.html)}return!1},formats:[{name:"YouTube",test:/^\s*(<iframe\b[^>]+?\bsrc="https?:\/\/www\.youtube(?:\-nocookie)?\.com\/embed\/[^?\/\\]+)(?:\?([^"]+))?([^>]*><\/iframe>)\s*$/i,html:"$1?wmode=transparent&$2$3"},{name:"YouTube",test:/^\s*(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?.*?\bv=([^&]+).*$/i,html:'<iframe src="//www.youtube.com/embed/$1?wmode=transparent" style="width:320px;height:240px" frameborder="0" allowfullscreen></iframe>'},{name:"YouTube",test:/^\s*(?:https?:\/\/)?(?:www\.)?youtube\.com\/[^#]*#(?:\w+\/)*(.*)$/i,html:'<iframe src="//www.youtube.com/embed/$1?wmode=transparent" style="width:320px;height:240px" frameborder="0" allowfullscreen></iframe>'},{name:"YouTube",test:/^\s*(?:https?:\/\/)?(?:www\.)?youtu.be\/([^?\/\\]+).*$/i,html:'<iframe src="//www.youtube.com/embed/$1?wmode=transparent" style="width:320px;height:240px" frameborder="0" allowfullscreen></iframe>'},{name:"Vimeo",test:/^\s*(<iframe\b[^>]+?\bsrc="https?:\/\/player\.vimeo\.com\/video\/\d+[^>]*><\/iframe>)(<p>.*?<\/p>)?\s*$/i,html:"$1$2"},{name:"Vimeo",test:/^\s*(?:http:\/\/)vimeo\.com\/(\d+)\s*$/i,html:'<iframe src="//player.vimeo.com/video/$1" style="width:320px;height:240px" frameborder="0" allowFullScreen></iframe>'}]}),HtmlArea.Tools.Video.title="Add Video",HtmlArea.Tools.Video.text="You<em>Tube</em>",HtmlArea.Tools.Video.setup=function(a){a.videoTool||(a.videoTool=new HtmlArea.Tools.Video(a))},HtmlArea.Tools.Video.run=function(a){a.videoTool.show()},HtmlArea.Tools.addTool("video",HtmlArea.Tools.Video);